include: 
  - docassemble.gbls:basic-questions-gbls.yml
  - LSLetters-text.yml
  - LSLetters-questions.yml
---
metadata:
  title: |
    Legal Server Letters
  short title: |
    LS Letters
  description: |
    This interview guides a Legal Server user in 
      sending letters or emails to clients and advocates.
  authors:
    - name: Michael Hofrichter
      organization: Houston Volunteer Lawyers
  revision_date: 2019-10-13
  tags: 
    - "sidebar_assignment_program"
    - "Legalserver"
    - "Staff"
---
mandatory: True
code: |
  clientmessage.language
  clientmessage.recipient
  clientmessage.text
  if clientmessage.method == "Email":
    LS_send_email
  elif clientmessage.method == "Letter":
    LS_send_letter
  all_done
---
code: |
  if clientmessage.recipient == "client":
    email_sent_ok = send_email(to=client, cc=value('case_email'), template=value(clientmessage.text))
  elif clientmessage.recipient == "advocate":
    email_sent_ok = send_email(to=advocate, cc=value('case_email'), template=value(clientmessage.text))
---
  if clientmessage.method == "Letter":
    email_copy_sent_ok = send_email(to=value('case_email'), template=LetterGenerated, attachments=[L${ clientmessage.text }.pdf, L${ clientmessage.text }.docx])
---
code: |
  if case_email.count('@') > 0:
    if case_email.count('legalserver.org') > 0: 
      if print(case_email[-25]) == "@hvl-demo.legalserver.org":
        casenumber = (print(case_email[(len(case_email)-25)]))
      elif case_email == "@hvl.legalserver.org": 
        casenumber = (print(case_email[(len(case_email)-20)]))
      else:
        casenumber = (print(case_email[(case_email.find('@')-1)]))
    else: 
      casenumber = (print(case_email[(case_email.find('@')-1)]))
  else:
    casenumber = case_email
---
code: |
  if client.gender == "male":
    client.title.en = "Mr."
  elif client.gender == "female":  
    client.title.en = "Ms."
  else: 
    client.title.en = "Mx"
---
code: |
  if advocate.gender == "male":
    advocate.title = "Mr."
  elif advocate.gender == "female":
    advocate.title = "Ms.""
  else: 
    advocate.title = "Mx"
---
code: |
  advocate.salutation = "Dear"
---
code: |  
  if client.gender == "male": 
    client.title.es = "Sr."
  elif client.gender == "female":
    client.title.es = "Sra."
  else:
    client.title.es = ""
---
code: |
  if client.gender == "male":
    client.title.vi = "Ông."
  elif client.gender == "female":
    client.title.vi = "Bà."
  else: 
    client.title.vi = ""
---
code: |
  if client.gender == "male":
    client.title.zo = "先生。"
  elif client.gender == "female":
    client.title.zo = "太太。"
  else: 
    client.title.zo = ""
---
code: |
  if client.language == "en":
    client.salutation = "Dear"
  elif client.language == "es":
    if client.gender == "male": 
      client.salutation = "Estimado"
    elif client.gender == "female":
      client.salutation = "Estimada"
    else:
      client.saludation = "Estimado/a"
  elif client.language == "vi":
    client.salutation = "Kính gửi"
  elif client.language == "zo":
    client.salutation = "亲爱的"
  else:
    client.salutation = "Dear"
---
modules:
  - docassemble.base.util
---
objects:
  - clientmessage: DAObject
---
question: |
  All Done
speak_text: True
ga id: screening_result
subquestion: |
  You're all done. Please feel free to close this window.
section: conclusion
#attachment:
#  name: The results of your Legal Checkup
#  filename: Screening_Results
#  docx template file: Pro_Se_Divorce_Screening_Results.docx
buttons:
  - Exit: exit
sets: all_done
---
question: |
  Email Sent
field: LS_send_email
subquestion: | 
  % if email_sent_ok:
  Email Sent
  % endif
---
question: |
  Letter Generated
subquestion: | 
  % if email_copy_sent_ok:
  The letter was generated and sent to the case email. It can also be downloaded here. 
  % else: 
  The letter was generated and *not* sent to the case email. It can be downloaded here.
  % endif
attachment: 
  name: L${ clientmessage.text }
  filename: L${ clientmessage.text }
  docx template file: Letterhead-client.docx
  valid formats: 
    - pdf
    - docx
field: LS_send_letter
---
template: LetterGenerated
subject: Letter Generated by Docassemble
content: | 
  The attached letter was generated by docassemble for this case. 

  It is to be sent by mail to ${ clientmessage.recepient }. 
